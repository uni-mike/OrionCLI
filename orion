#!/bin/bash

# Orion - Azure OpenAI CLI
# Usage: ./orion [model|task] [--prompt "text"]

# Load environment variables from .env file
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
if [ -f "$SCRIPT_DIR/.env" ]; then
    set -a
    source "$SCRIPT_DIR/.env"
    set +a
fi

MODEL=${1:-gpt-5-chat}
ARGS=""

# Check if first arg is a model/task name
case "$1" in
    gpt-5|gpt-5-chat|gpt-5-mini|gpt-4o|o3|o4-mini|reasoning|planning|coding|chat|fast|multimodal)
        shift
        ARGS="$@"
        ;;
    *)
        MODEL="gpt-5-chat"
        ARGS="$@"
        ;;
esac

# API Keys - Set these as environment variables or update here
DEFAULT_KEY="${ORION_DEFAULT_KEY:-YOUR_DEFAULT_AZURE_KEY}"
O3_KEY="${ORION_O3_KEY:-YOUR_O3_AZURE_KEY}"
export AZURE_OPENAI_API_VERSION="2024-12-01-preview"

# Map task types to models
case "$MODEL" in
    reasoning|planning) MODEL="o3" ;;
    coding) MODEL="gpt-5" ;;
    chat) MODEL="gpt-5-chat" ;;
    fast) MODEL="o4-mini" ;;
    multimodal) MODEL="gpt-4o" ;;
esac

# Set endpoint, deployment, and API key based on model
case "$MODEL" in
    o3)
        export AZURE_OPENAI_ENDPOINT="https://unipathai7556217047.openai.azure.com"
        export AZURE_OPENAI_DEPLOYMENT="o3"
        export AZURE_OPENAI_KEY="$O3_KEY"
        ;;
    gpt-4o)
        export AZURE_OPENAI_ENDPOINT="https://unipathai7556217047.openai.azure.com"
        export AZURE_OPENAI_DEPLOYMENT="gpt-4o"
        export AZURE_OPENAI_KEY="$O3_KEY"
        ;;
    o4-mini)
        export AZURE_OPENAI_ENDPOINT="https://mike-mazsz1c6-eastus2.openai.azure.com"
        export AZURE_OPENAI_DEPLOYMENT="o4-mini"
        export AZURE_OPENAI_KEY="$DEFAULT_KEY"
        ;;
    gpt-5)
        export AZURE_OPENAI_ENDPOINT="https://mike-mazsz1c6-eastus2.openai.azure.com"
        export AZURE_OPENAI_DEPLOYMENT="gpt-5"
        export AZURE_OPENAI_KEY="$DEFAULT_KEY"
        ;;
    gpt-5-mini)
        export AZURE_OPENAI_ENDPOINT="https://mike-mazsz1c6-eastus2.openai.azure.com"
        export AZURE_OPENAI_DEPLOYMENT="gpt-5-mini"
        export AZURE_OPENAI_KEY="$DEFAULT_KEY"
        ;;
    *)
        export AZURE_OPENAI_ENDPOINT="https://mike-mazsz1c6-eastus2.openai.azure.com"
        export AZURE_OPENAI_DEPLOYMENT="gpt-5-chat"
        export AZURE_OPENAI_KEY="$DEFAULT_KEY"
        ;;
esac

# Get script directory
DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Run Orion CLI
exec node "$DIR/orion-cli.js" $ARGS